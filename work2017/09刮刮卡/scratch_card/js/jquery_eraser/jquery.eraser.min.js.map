{"version":3,"sources":["plugins/jquery_eraser/jquery.eraser.js"],"names":["$","methods","init","options","this","each","$this","data","handleImage","$canvas","canvas","get","ctx","getContext","scaleRatio","window","devicePixelRatio","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio","realWidth","width","realHeight","height","pos","offset","enabled","size","completeRatio","completeFunction","progressFunction","zIndex","css","parts","colParts","Math","floor","numParts","n","that","after","id","className","style","toString","drawImage","remove","globalCompositeOperation","strokeStyle","lineWidth","lineCap","bind","mouseDown","touchStart","touchMove","touchEnd","push","posX","left","posY","top","touchDown","touchID","touchX","touchY","ptouchX","ptouchY","w","h","source","ratio","complete","resize","naturalWidth","on","event","t","originalEvent","changedTouches","tx","pageX","ty","pageY","evaluatePoint","identifier","preventDefault","ta","length","beginPath","moveTo","lineTo","stroke","z-index","parseInt","p","mouseMove","document","mouseUp","unbind","clear","clearRect","enable","disable","value","reset","progress","fn","eraser","method","apply","Array","prototype","slice","call","arguments","_typeof","error","jQuery"],"mappings":"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","file":"jquery.eraser.min.js","sourcesContent":["/*\n* jQuery.eraser v0.5.2\n* makes any image or canvas erasable by the user, using touch or mouse input\n* https://github.com/boblemarin/jQuery.eraser\n*\n* Usage:\n*\n* $('#myImage').eraser(); // simple way\n*\n* $('#canvas').eraser( {\n*   size: 20, // define brush size (default value is 40)\n*   completeRatio: .65, // allows to call function when a erased ratio is reached (between 0 and 1, default is .7 )\n*   completeFunction: myFunction // callback function when complete ratio is reached\n* } );\n*\n* $('#image').eraser( 'clear' ); // erases all canvas content\n*\n* $('#image').eraser( 'reset' ); // revert back to original content\n*\n* $('#image').eraser( 'size', 80 ); // change the eraser size\n*\n* $('#image').eraser( 'enable/disable' ); // enable or disable erasing\n*\n* $('#image').eraser( 'enabled' ); // returns whether the eraser is enabled\n*\n*\n* https://github.com/boblemarin/jQuery.eraser\n* http://minimal.be/lab/jQuery.eraser/\n*\n* Copyright (c) 2010 boblemarin emeric@minimal.be http://www.minimal.be\n*\n* Permission is hereby granted, free of charge, to any person\n* obtaining a copy of this software and associated documentation\n* files (the \"Software\"), to deal in the Software without\n* restriction, including without limitation the rights to use,\n* copy, modify, merge, publish, distribute, sublicense, and/or sell\n* copies of the Software, and to permit persons to whom the\n* Software is furnished to do so, subject to the following\n* conditions:\n*\n* The above copyright notice and this permission notice shall be\n* included in all copies or substantial portions of the Software.\n*\n* THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n* OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n* HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n* WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n* OTHER DEALINGS IN THE SOFTWARE.\n*/\n\n(function($){\n  var methods = {\n\n    init: function(options) {\n      return this.each(function(){\n        var $this = $(this),\n            data = $this.data('eraser');\n\n        if (!data) {\n\n          var handleImage = function() {\n            var $canvas = $('<canvas/>'),\n                canvas = $canvas.get(0),\n                ctx = canvas.getContext('2d'),\n\n                // calculate scale ratio for high DPI devices\n                // http://www.html5rocks.com/en/tutorials/canvas/hidpi/\n                devicePixelRatio = window.devicePixelRatio || 1,\n                backingStoreRatio = ctx.webkitBackingStorePixelRatio ||\n                    ctx.mozBackingStorePixelRatio ||\n                    ctx.msBackingStorePixelRatio ||\n                    ctx.oBackingStorePixelRatio ||\n                    ctx.backingStorePixelRatio || 1,\n                scaleRatio = devicePixelRatio / backingStoreRatio,\n\n                realWidth = $this.width(),\n                realHeight = $this.height(),\n                width = realWidth * scaleRatio,\n                height = realHeight * scaleRatio,\n                pos = $this.offset(),\n                enabled = (options && options.enabled === false) ? false : true,\n                size = ((options && options.size) ? options.size : 40) * scaleRatio,\n                completeRatio = (options && options.completeRatio) ? options.completeRatio : .7,\n                completeFunction = (options && options.completeFunction) ? options.completeFunction : null,\n                progressFunction = (options && options.progressFunction) ? options.progressFunction : null,\n                zIndex = $this.css('z-index') == \"auto\"?1:$this.css('z-index'),\n                parts = [],\n                colParts = Math.floor(width / size),\n                numParts = colParts * Math.floor(height / size),\n                n = numParts,\n                that = $this[0];\n\n            // replace target with canvas\n            $this.after($canvas);\n            canvas.id = that.id;\n            canvas.className = that.className;\n            canvas.width = width;\n            canvas.height = height;\n            canvas.style.width = realWidth.toString() + \"px\";\n            canvas.style.height = realHeight.toString() + \"px\";\n            ctx.drawImage(that, 0, 0, width, height);\n            $this.remove();\n\n            // prepare context for drawing operations\n            ctx.globalCompositeOperation = 'destination-out';\n            ctx.strokeStyle = 'rgba(255,0,0,255)';\n            ctx.lineWidth = size;\n\n            ctx.lineCap = 'round';\n            // bind events\n            $canvas.bind('mousedown.eraser', methods.mouseDown);\n            $canvas.bind('touchstart.eraser', methods.touchStart);\n            $canvas.bind('touchmove.eraser', methods.touchMove);\n            $canvas.bind('touchend.eraser', methods.touchEnd);\n\n            // reset parts\n            while(n--) parts.push(1);\n\n            // store values\n            data = {\n              posX: pos.left,\n              posY: pos.top,\n              touchDown: false,\n              touchID: -999,\n              touchX: 0,\n              touchY: 0,\n              ptouchX: 0,\n              ptouchY: 0,\n              canvas: $canvas,\n              ctx: ctx,\n              w: width,\n              h: height,\n              scaleRatio: scaleRatio,\n              source: that,\n              size: size,\n              parts: parts,\n              colParts: colParts,\n              numParts: numParts,\n              ratio: 0,\n              enabled: enabled,\n              complete: false,\n              completeRatio: completeRatio,\n              completeFunction: completeFunction,\n              progressFunction: progressFunction,\n              zIndex: zIndex\n            };\n            $canvas.data('eraser', data);\n\n            // listen for resize event to update offset values\n            $(window).resize(function() {\n              var pos = $canvas.offset();\n              data.posX = pos.left;\n              data.posY = pos.top;\n            });\n          }\n\n          if (this.complete && this.naturalWidth > 0) {\n            handleImage();\n          } else {\n            //this.onload = handleImage;\n            $this.on('load', handleImage);\n          }\n        }\n      });\n    },\n\n    touchStart: function(event) {\n      var $this = $(this),\n          data = $this.data('eraser');\n\n      if (!data.touchDown) {\n        var t = event.originalEvent.changedTouches[0],\n            tx = t.pageX - data.posX,\n            ty = t.pageY - data.posY;\n        tx *= data.scaleRatio;\n        ty *= data.scaleRatio;\n\n        if (data.enabled) {\n          methods.evaluatePoint(data, tx, ty);\n        }\n\n        data.touchDown = true;\n        data.touchID = t.identifier;\n        data.touchX = tx;\n        data.touchY = ty;\n        event.preventDefault();\n      }\n    },\n\n    touchMove: function(event) {\n      var $this = $(this),\n          data = $this.data('eraser');\n\n      if (data.touchDown) {\n        var ta = event.originalEvent.changedTouches,\n            n = ta.length;\n        while (n--) {\n          if (ta[n].identifier == data.touchID) {\n            var tx = ta[n].pageX - data.posX,\n                ty = ta[n].pageY - data.posY;\n            tx *= data.scaleRatio;\n            ty *= data.scaleRatio;\n\n            if (data.enabled) {\n              methods.evaluatePoint(data, tx, ty);\n              data.ctx.beginPath();\n              data.ctx.moveTo(data.touchX, data.touchY);\n              data.ctx.lineTo(tx, ty);\n              data.ctx.stroke();\n              $this.css({\"z-index\":$this.css('z-index')==data.zIndex?parseInt(data.zIndex)+1:data.zIndex});\n            }\n\n            data.touchX = tx;\n            data.touchY = ty;\n\n            event.preventDefault();\n            break;\n          }\n        }\n      }\n    },\n\n    touchEnd: function(event) {\n      var $this = $(this),\n        data = $this.data('eraser');\n\n      if ( data.touchDown ) {\n        var ta = event.originalEvent.changedTouches,\n          n = ta.length;\n        while( n-- ) {\n          if ( ta[n].identifier == data.touchID ) {\n            data.touchDown = false;\n            event.preventDefault();\n            break;\n          }\n        }\n      }\n    },\n\n    evaluatePoint: function(data, tx, ty) {\n      if (!data.enabled) return;\n      var p = Math.floor(tx/data.size) + Math.floor( ty / data.size ) * data.colParts;\n\n      if ( p >= 0 && p < data.numParts ) {\n        data.ratio += data.parts[p];\n        data.parts[p] = 0;\n        if (!data.complete) {\n          p = data.ratio/data.numParts;\n          if ( p >= data.completeRatio ) {\n            data.complete = true;\n            if ( data.completeFunction != null ) data.completeFunction();\n          } else {\n            if ( data.progressFunction != null ) data.progressFunction(p);\n          }\n        }\n      }\n\n    },\n\n    mouseDown: function(event) {\n      var $this = $(this),\n          data = $this.data('eraser'),\n          tx = event.pageX - data.posX,\n          ty = event.pageY - data.posY;\n      tx *= data.scaleRatio;\n      ty *= data.scaleRatio;\n\n      data.touchDown = true;\n      data.touchX = tx;\n      data.touchY = ty;\n\n      if (data.enabled) {\n        methods.evaluatePoint( data, tx, ty );\n\n        data.ctx.beginPath();\n        data.ctx.moveTo(data.touchX-1, data.touchY);\n        data.ctx.lineTo(data.touchX, data.touchY);\n        data.ctx.stroke();\n      }\n\n      $this.bind('mousemove.eraser', methods.mouseMove);\n      $(document).bind('mouseup.eraser', data, methods.mouseUp);\n      event.preventDefault();\n    },\n\n    mouseMove: function(event) {\n      var $this = $(this),\n          data = $this.data('eraser'),\n          tx = event.pageX - data.posX,\n          ty = event.pageY - data.posY;\n      tx *= data.scaleRatio;\n      ty *= data.scaleRatio;\n\n      if (data.enabled) {\n        methods.evaluatePoint( data, tx, ty );\n        data.ctx.beginPath();\n        data.ctx.moveTo( data.touchX, data.touchY );\n        data.ctx.lineTo( tx, ty );\n        data.ctx.stroke();\n        $this.css({\"z-index\":$this.css('z-index')==data.zIndex?parseInt(data.zIndex)+1:data.zIndex});\n      }\n\n      data.touchX = tx;\n      data.touchY = ty;\n\n      event.preventDefault();\n    },\n\n    mouseUp: function(event) {\n      var data = event.data,\n          $this = data.canvas;\n\n      data.touchDown = false;\n      $this.unbind('mousemove.eraser');\n      $(document).unbind('mouseup.eraser');\n      event.preventDefault();\n    },\n\n    clear: function() {\n      var $this = $(this),\n          data = $this.data('eraser');\n\n      if (data) {\n        data.ctx.clearRect(0, 0, data.w, data.h);\n        var n = data.numParts;\n        while(n--) data.parts[n] = 0;\n        data.ratio = data.numParts;\n        data.complete = true;\n        if (data.completeFunction != null) data.completeFunction();\n      }\n    },\n\n    enabled: function() {\n      var $this = $(this),\n          data = $this.data('eraser');\n\n      if (data && data.enabled) {\n        return true;\n      }\n      return false;\n    },\n\n    enable: function() {\n      var $this = $(this),\n          data = $this.data('eraser');\n\n      if (data) {\n        data.enabled = true;\n      }\n    },\n\n    disable: function() {\n      var $this = $(this),\n          data = $this.data('eraser');\n\n      if (data) {\n        data.enabled = false;\n      }\n    },\n\n    size: function(value) {\n      var $this = $(this),\n          data = $this.data('eraser');\n\n      if (data && value) {\n        data.size = value;\n        data.ctx.lineWidth = value;\n      }\n    },\n\n    reset: function() {\n      var $this = $(this),\n          data = $this.data('eraser');\n\n      if (data) {\n        data.ctx.globalCompositeOperation = 'source-over';\n        data.ctx.drawImage( data.source, 0, 0, data.w, data.h);\n        data.ctx.globalCompositeOperation = 'destination-out';\n        var n = data.numParts;\n        while (n--) data.parts[n] = 1;\n        data.ratio = 0;\n        data.complete = false;\n        data.touchDown = false;\n      }\n    },\n\n    progress: function() {\n      var $this = $(this),\n          data = $this.data('eraser');\n\n      if (data) {\n        return data.ratio/data.numParts;\n      }\n      return 0;\n    }\n\n  };\n\n  $.fn.eraser = function(method) {\n    if (methods[method]) {\n      return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));\n    } else if (typeof method === 'object' || ! method) {\n      return methods.init.apply(this, arguments);\n    } else {\n      $.error('Method ' +  method + ' does not yet exist on jQuery.eraser');\n    }\n  };\n})(jQuery);\n"]}