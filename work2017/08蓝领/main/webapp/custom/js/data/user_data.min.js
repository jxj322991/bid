$(function(){function t(t){t?echarts.init(document.getElementById("user_trend"),theme).setOption(D):$(".chart_box").html("暂无数据")}function e(t){t?echarts.init(document.getElementById("uv_chart"),theme).setOption(B):$("#uv_chart").html("暂无数据")}function a(t){t?echarts.init(document.getElementById("user_rate"),theme).setOption(H):$("#user_rate").html("暂无数据")}function n(t){t?echarts.init(document.getElementById("device_chart"),theme).setOption(w):$("#device_chart").html("暂无数据")}function i(t){t?echarts.init(document.getElementById("topTime_chart"),theme).setOption(P):$("#topTime_chart").html("暂无数据")}function o(t){t?echarts.init(document.getElementById("deep_chart"),theme).setOption(S):$("#deep_chart").html("暂无数据")}function s(t){t?echarts.init(document.getElementById("retained_chart"),theme).setOption(j):$("#retained_chart").html("暂无数据")}function r(t){t?echarts.init(document.getElementById("jump_chart"),theme).setOption(M):$("#jump_chart").html("暂无数据")}function m(t){t?echarts.init(document.getElementById("stay_chart"),theme).setOption(V):$("#stay_chart").html("暂无数据")}function d(t){t?echarts.init(document.getElementById("share_chart"),theme).setOption(G):$("#share_chart").html("暂无数据")}function c(t){t?echarts.init(document.getElementById("spread_chart"),theme).setOption(z):$("#spread_chart").html("暂无数据")}function l(t){t?echarts.init(document.getElementById("city_chart"),theme).setOption(R):$("#city_chart").html("暂无数据")}function y(){function n(t){1==t.code?($("#total_uv").html(t.context.yUV),$("#total_pv").html(t.context.yPV)):alert(t.msg)}function s(t){1==t.code?(B.xAxis[0].data=t.context.x,B.series[0].data=t.context.yUV,B.series[1].data=t.context.yPerUV,t.context.yHBUV.length>0?($("#uv .data_item").show(),$("#uv .total span").html(t.context.yHBUV[0]),$("#uv .hb").html(t.context.yHBUV[1]+"%")):($("#uv .data_item").show(),$("#uv .total span").html(t.context.yTotalUV),$("#uv .hb").html("")),e(t.context.x.length>0?!0:!1)):alert(t.msg)}function l(e){1==e.code?(D.xAxis[0].data=e.context.x,D.series[0].data=e.context.yNewusers,D.series[1].data=e.context.yPerNewusers,S.xAxis[0].data=e.context.x,S.series[0].data=e.context.yDeep,S.series[1].data=e.context.yPerDeep,M.xAxis[0].data=e.context.x,M.series[0].data=e.context.yJump,M.series[1].data=e.context.yPerJump,V.xAxis[0].data=e.context.x,V.series[0].data=e.context.yPersist,V.series[1].data=e.context.yPerPersist,G.xAxis[0].data=e.context.x,G.series[0].data=e.context.yShare,G.series[1].data=e.context.yShareRate,e.context.yHBNewusers.length>0&&($("#user .data_item").show(),$("#user .total span").html(e.context.yHBNewusers[0]),$("#user .hb").html(e.context.yHBNewusers[1]+"%")),e.context.yHBJump.length>0&&($("#jump .data_item").show(),$("#jump .total span").html(e.context.yHBJump[0]),$("#jump .hb").html(e.context.yHBJump[1]+"%")),e.context.yHBDeep.length>0&&($("#deep .data_item").show(),$("#deep .total span").html(e.context.yHBDeep[0]),$("#deep .hb").html(e.context.yHBDeep[1]+"%")),e.context.yHBPersist.length>0&&($("#stay .data_item").show(),$("#stay .total span").html(e.context.yHBPersist[0]),$("#stay .hb").html(e.context.yHBPersist[1]+"%")),e.context.x.length>0?(t(!0),o(!0),r(!0),m(!0),d(!0)):(t(!1),o(!1),r(!1),m(!1),d(!1))):alert(e.msg)}function y(t){if(1==t.code){H.series[0].data=[];for(var e=0;e<t.context.yNewer.length;e++)H.series[0].data.push({name:t.context.yNewer[e].label,value:t.context.yNewer[e].amount});a(t.context.yNewer.length>0?!0:!1)}else alert(t.msg)}function u(t){if(1==t.code){var e=t.context.yPV;P.angleAxis.data=t.context.x,P.series[0].data=e.map(function(t){return t[0]}),P.series[1].data=e.map(function(t){return 2*A}),i(t.context.yPV.length>0?!0:!1)}else alert(t.msg)}function h(t){if(1==t.code){var e=t.context.yPV;z.angleAxis.data=t.context.x,z.series[0].data=e.map(function(t){return t[0]}),z.series[1].data=e.map(function(t){return 2*A}),c(t.context.yPV.length>0?!0:!1)}else alert(t.msg)}$.ajax({type:"POST",url:"/api/v1/data/GetPV",data:O,success:function(t){ajaxResHandle(t,n)}}),$.ajax({type:"POST",url:"/api/v1/data/GetPVTrend",data:O,success:function(t){ajaxResHandle(t,s)}}),$.ajax({type:"POST",url:"/api/v1/data/GetUserTrend",data:O,success:function(t){ajaxResHandle(t,l)}}),$.ajax({type:"POST",url:"/api/v1/data/GetNewUserRate",data:O,success:function(t){ajaxResHandle(t,y)}}),$.ajax({type:"POST",url:"/api/v1/data/GetPVPeakHour",data:O,success:function(t){ajaxResHandle(t,u)}}),$.ajax({type:"POST",url:"/api/v1/data/GetTransLevel",data:O,success:function(t){ajaxResHandle(t,h)}})}function u(){function t(t){1==t.code?(R.yAxis.data=t.context.x,R.series[0].data=t.context.yPV,l(t.context.x.length>0?!0:!1)):alert(t.msg)}function e(t){if(1==t.code){w.series[0].data=[];for(var e=0;e<t.context.yUV.length;e++)w.series[0].data.push({name:t.context.yUV[e].label,value:t.context.yUV[e].amount});n(t.context.yUV.length>0?!0:!1)}else alert(t.msg)}$.ajax({type:"POST",url:"/api/v1/data/GetUserRegion",data:{activity_id:"WBQqrP5y40Hbqh1iowOxs69RcO",beginTime:_+" 00:00:00",endTime:_+" 23:59:59",topn:10},success:function(e){ajaxResHandle(e,t)}}),$.ajax({type:"POST",url:"/api/v1/data/GetOsRate",data:{activity_id:"WBQqrP5y40Hbqh1iowOxs69RcO",beginTime:v+" 00:00:00",endTime:v+" 23:59:59",topn:10},success:function(t){ajaxResHandle(t,e)}})}function h(){function t(t){1==t.code?(j.xAxis[0].data=t.context.x,j.series[0].data=t.context.yDateRate,s(t.context.x.length>0?!0:!1)):alert(t.msg)}$.ajax({type:"POST",url:"/api/v1/data/GetRetainTrend",data:T,success:function(e){ajaxResHandle(e,t)}})}function p(t,e){var a,n,i;return a=t.split("-"),n=new Date(a[1]+"-"+a[2]+"-"+a[0]),a=e.split("-"),i=new Date(a[1]+"-"+a[2]+"-"+a[0]),parseInt(Math.abs(n-i)/1e3/60/60/24)}var x=location.search,g=/(\\?|\\&)activity_id=([^&?]*)/gi,f=x.match(g)?x.match(g).join("").replace("activity_id=",""):"",b=(new Date).getTime(),v=moment(b).format("YYYY-MM-DD"),_=moment(b).subtract(1,"days").format("YYYY-MM-DD");$(".time").html(v),$("#type_prize").attr("href","/html/data/prize-data.html?activity_id="+f),$("#type_scan").attr("href","/html/data/scan-data.html?activity_id="+f);var O={activity_id:f,beginTime:v+" 00:00:00",endTime:v+" 23:59:59",perBeginTime:_+" 00:00:00",perEndTime:_+" 23:59:59"},Y={activity_id:f,beginTime:v+" 00:00:00",endTime:v+" 23:59:59",topn:10},T={activity_id:f,beginTime:_+" 00:00:00",endTime:_+" 23:59:59"},D={grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},legend:{data:["本周期数据趋势","与上周期的趋势对比"]},tooltip:{trigger:"axis"},xAxis:[{type:"category",boundaryGap:!1,data:[]}],yAxis:[{type:"value"}],series:[{name:"本周期数据趋势",type:"line",smooth:!0,areaStyle:{normal:{}},data:[],z:2},{name:"与上周期的趋势对比",type:"line",smooth:!0,areaStyle:{normal:{}},data:[],z:1}]},B={grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},legend:{data:["本周期数据趋势","与上周期的趋势对比"]},tooltip:{trigger:"axis"},xAxis:[{type:"category",boundaryGap:!1,data:[]}],yAxis:[{type:"value"}],series:[{name:"本周期数据趋势",type:"line",smooth:!0,areaStyle:{normal:{}},data:[],z:2},{name:"与上周期的趋势对比",type:"line",smooth:!0,areaStyle:{normal:{}},data:[],z:1}]},H={tooltip:{trigger:"item"},series:[{name:"数量",type:"pie",hoverAnimation:!1,radius:"55%",center:["50%","60%"],data:[],itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},w={tooltip:{trigger:"item"},series:[{name:"数量",type:"pie",hoverAnimation:!1,radius:"55%",center:["50%","60%"],data:[],itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},A=50,P={angleAxis:{type:"category",data:[]},radiusAxis:{},polar:{},series:[{type:"bar",data:[],coordinateSystem:"polar",name:"",stack:""},{type:"bar",data:[],coordinateSystem:"polar",name:"均值",stack:"均值",barGap:"-100%",z:10}],legend:{show:!0,data:["A","B","C"]}},S={grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},legend:{data:["本周期数据趋势","与上周期的趋势对比"]},tooltip:{trigger:"axis"},xAxis:[{type:"category",boundaryGap:!1,data:[]}],yAxis:[{type:"value"}],series:[{name:"本周期数据趋势",type:"line",smooth:!0,areaStyle:{normal:{}},data:[],z:2},{name:"与上周期的趋势对比",type:"line",smooth:!0,areaStyle:{normal:{}},data:[],z:1}]},j={grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},legend:{data:["本周期数据趋势"]},tooltip:{trigger:"axis"},xAxis:[{type:"category",boundaryGap:!1,data:[]}],yAxis:[{type:"value"}],series:[{name:"本周期数据趋势",type:"line",smooth:!0,areaStyle:{normal:{}},data:[],z:2}]},M={grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},legend:{data:["本周期数据趋势","与上周期的趋势对比"]},tooltip:{trigger:"axis"},xAxis:[{type:"category",boundaryGap:!1,data:[]}],yAxis:[{type:"value"}],series:[{name:"本周期数据趋势",type:"line",smooth:!0,areaStyle:{normal:{}},data:[],z:2},{name:"与上周期的趋势对比",type:"line",smooth:!0,areaStyle:{normal:{}},data:[],z:1}]},V={grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},legend:{data:["本周期数据趋势","与上周期的趋势对比"]},tooltip:{trigger:"axis"},xAxis:[{type:"category",boundaryGap:!1,data:[]}],yAxis:[{type:"value"}],series:[{name:"本周期数据趋势",type:"line",smooth:!0,areaStyle:{normal:{}},data:[],z:2},{name:"与上周期的趋势对比",type:"line",smooth:!0,areaStyle:{normal:{}},data:[],z:1}]},G={grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},legend:{data:["分享量","分享率"]},tooltip:{trigger:"axis"},xAxis:[{type:"category",boundaryGap:!1,data:[]}],yAxis:[{type:"value"}],series:[{name:"本周期数据趋势",type:"line",smooth:!0,areaStyle:{normal:{}},data:[],z:2},{name:"与上周期的趋势对比",type:"line",smooth:!0,areaStyle:{normal:{}},data:[],z:1}]},z={angleAxis:{type:"category",data:[]},radiusAxis:{},polar:{},series:[{type:"bar",data:[],coordinateSystem:"polar",name:"",stack:""},{type:"bar",data:[],coordinateSystem:"polar",name:"均值",stack:"均值",barGap:"-100%",z:10}],legend:{show:!0,data:["A","B","C"]}},R={tooltip:{trigger:"axis",axisPointer:{type:"shadow",shadowStyle:{color:"rgba(106,186,232,.1)"}}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"value",boundaryGap:[0,.01]},yAxis:{type:"category",data:[]},series:[{name:"访问用户省市分布前10名",type:"bar",data:[]}]};y(),h(),u(),$(".time_btn_box").on("click",function(){$(".time_box ul").show()}),$(".time_box ul").on("click",function(t){if(!$(t.target).hasClass(".active")){$(".time_box ul li").removeClass("active"),$(t.target).addClass("active"),$(".time_box ul").hide(),$(".time_item").html($(t.target).attr("tag")+"天");var e=null,a=null,n=null,i=null;switch($(t.target).attr("tag")){case"7":e=moment(b).subtract(7,"days").startOf("day").format("l"),a=moment(b).subtract(1,"days").endOf("day").format("l"),n=moment(b).subtract(14,"days").startOf("day").format("l"),i=moment(b).subtract(8,"days").endOf("day").format("l"),$(".time").html(moment(b).subtract(7,"days").startOf("day").format("YYYY-MM-DD")+"-"+moment(b).subtract(1,"days").endOf("day").format("YYYY-MM-DD"));break;case"14":e=moment(b).subtract(14,"days").startOf("day").format("l"),a=moment(b).subtract(1,"days").endOf("day").format("l"),n=moment(b).subtract(28,"days").startOf("day").format("l"),i=moment(b).subtract(15,"days").endOf("day").format("l"),$(".time").html(moment(b).subtract(14,"days").startOf("day").format("YYYY-MM-DD")+"-"+moment(b).subtract(1,"days").endOf("day").format("YYYY-MM-DD"));break;case"28":e=moment(b).subtract(28,"days").startOf("day").format("l"),a=moment(b).subtract(1,"days").endOf("day").format("l"),n=moment(b).subtract(56,"days").startOf("day").format("l"),i=moment(b).subtract(29,"days").endOf("day").format("l"),$(".time").html(moment(b).subtract(28,"days").startOf("day").format("YYYY-MM-DD")+"-"+moment(b).subtract(1,"days").endOf("day").format("YYYY-MM-DD"));break;case"all":$(".time_item").html("全部"),e=project_b_time+" 00:00:00",a=moment(b).endOf("day").format("l"),n="",i="",$(".muted").html(project_b_time+"-"+v)}O={activity_id:f,beginTime:e,endTime:a,perBeginTime:n,perEndTime:i},Y={activity_id:f,beginTime:e,endTime:a,topn:10},T={activity_id:f,beginTime:e,endTime:a},y(),h(),u()}});var E=flatpickr(".flatpickr-input",{mode:"range",locale:"zh",dateFormat:"Y-m-d H:i",maxDate:new Date,onClose:function(t,e,a){console.log(t);var n=E.formatDate(E.selectedDates[0],"Y-m-d H:i:S"),i=moment(E.selectedDates[1].getTime()).endOf("day").format("l"),o=E.formatDate(E.selectedDates[0],"Y-m-d"),s=E.formatDate(E.selectedDates[0],"Y-m-d");$(".flatpickr-input").val(E.formatDate(E.selectedDates[0],"Y-m-d H:i")+" 至 "+moment(E.selectedDates[1].getTime()).endOf("day").format("YYYY-MM-DD HH:mm"));var r=p(o,s);r>0?$(".time").html(o+" - "+s):$(".time").html(o);var m=moment(n).subtract(r+1,"days").format("YYYY-MM-DD HH:mm:ss"),d=moment(i).subtract(r+1,"days").format("YYYY-MM-DD HH:mm:ss");O={activity_id:f,beginTime:n,endTime:i,perBeginTime:m,perEndTime:d},Y={activity_id:f,beginTime:n,endTime:i,topn:10},T={activity_id:f,beginTime:n,endTime:i},y(),h(),u()}})});