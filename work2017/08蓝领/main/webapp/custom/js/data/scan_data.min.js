$(function(){function t(t){t?echarts.init(document.getElementById("scan_trend"),theme).setOption(x):$("#scan_trend").html("暂无数据")}function e(t){t?echarts.init(document.getElementById("first_trend"),theme).setOption(h):$("#first_trend").html("暂无数据")}function a(t){t?echarts.init(document.getElementById("uv_trend"),theme).setOption(p):$("#uv_trend").html("暂无数据")}function n(t){t?echarts.init(document.getElementById("pv_trend"),theme).setOption(g):$("#pv_trend").html("暂无数据")}function m(t){t?echarts.init(document.getElementById("regional_trend"),theme).setOption(Y):$("#regional_trend").html("暂无数据")}function i(){function i(t){1==t.code?($("#scan_total").html(t.context.yPV),$("#first_scan").html(t.context.yVERIFY),$("#scan_code_num").html(t.context.yCODE)):alert(t.msg)}function o(a){1==a.code?(x.xAxis[0].data=a.context.x,x.series[0].data=a.context.yPV,x.series[1].data=a.context.yPerPV,h.xAxis[0].data=a.context.x,h.series[0].data=a.context.yVERIFY,h.series[1].data=a.context.yPerVERIFY,a.context.yHBPV.length>0?($("#scan .data_item").show(),$("#scan .total span").html(a.context.yHBPV[0]),$("#scan .hb").html(a.context.yHBPV[1]+"%")):$("#scan .data_item").hide(),a.context.yHBVERIFY.length>0?($("#first .data_item").show(),$("#first .total span").html(a.context.yHBVERIFY[0]),$("#first .hb").html(a.context.yHBVERIFY[1]+"%")):$("#first .data_item").hide(),a.context.x.length>0?(t(!0),e(!0)):(t(!1),e(!1))):alert(a.msg)}function s(t){1==t.code?(p.xAxis[0].data=t.context.x,p.series[0].data=t.context.yUV,p.series[1].data=t.context.yPerUV,g.xAxis[0].data=t.context.x,g.series[0].data=t.context.yPV,g.series[1].data=t.context.yPerPV,t.context.yHBUV.length>0?($("#uv .data_item").show(),$("#uv .total span").html(t.context.yHBUV[0]),$("#uv .hb").html(t.context.yHBUV[1]+"%")):$("#uv .data_item").hide(),t.context.yHBPV.length>0?($("#pv .data_item").show(),$("#pv .total span").html(t.context.yHBPV[0]),$("#pv .hb").html(t.context.yHBPV[1]+"%")):$("#pv .data_item").hide(),t.context.x.length>0?(a(!0),n(!0)):(a(!1),n(!1))):alert(t.msg)}function r(t){1==t.code?(Y.yAxis.data=t.context.x,Y.series[0].data=t.context.yPV,m(t.context.x.length>0?!0:!1)):alert(t.msg)}$.ajax({type:"POST",url:"/api/v1/data/GetScanData",data:f,success:function(t){ajaxResHandle(t,i)}}),$.ajax({type:"POST",url:"/api/v1/data/GetScanTrend",data:f,success:function(t){ajaxResHandle(t,o)}}),$.ajax({type:"POST",url:"/api/v1/data/GetPVTrend",data:f,success:function(t){ajaxResHandle(t,s)}}),$.ajax({type:"POST",url:"/api/v1/data/GetScanRegion",data:u,success:function(t){ajaxResHandle(t,r)}})}function o(t,e){var a,n,m;return a=t.split("-"),n=new Date(a[1]+"-"+a[2]+"-"+a[0]),a=e.split("-"),m=new Date(a[1]+"-"+a[2]+"-"+a[0]),parseInt(Math.abs(n-m)/1e3/60/60/24)}var s=location.search,r=/(\\?|\\&)activity_id=([^&?]*)/gi,d=s.match(r)?s.match(r).join("").replace("activity_id=",""):"",l=(new Date).getTime(),c=moment(l).format("YYYY-MM-DD"),y=moment(l).subtract(1,"days").format("YYYY-MM-DD");$("#type_prize").attr("href","/html/data/prize-data.html?activity_id="+d),$("#type_scan").attr("href","/html/data/user-data.html?activity_id="+d);var f={activity_id:d,beginTime:c+" 00:00:00",endTime:c+" 23:59:59",perBeginTime:y+" 00:00:00",perEndTime:y+" 23:59:59"},u={activity_id:d,beginTime:c+" 00:00:00",endTime:c+" 23:59:59",topn:10};$(".time").html(c);var x={grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},legend:{data:["本周期数据趋势","与上周期的趋势对比"]},tooltip:{trigger:"axis"},xAxis:[{type:"category",boundaryGap:!1,data:[]}],yAxis:[{type:"value"}],series:[{name:"本周期数据趋势",type:"line",smooth:!0,areaStyle:{normal:{}},data:[],z:2},{name:"与上周期的趋势对比",type:"line",smooth:!0,areaStyle:{normal:{}},data:[],z:1}]},h={grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},legend:{data:["本周期数据趋势","与上周期的趋势对比"]},tooltip:{trigger:"axis"},xAxis:[{type:"category",boundaryGap:!1,data:[]}],yAxis:[{type:"value"}],series:[{name:"本周期数据趋势",type:"line",smooth:!0,areaStyle:{normal:{}},data:[],z:2},{name:"与上周期的趋势对比",type:"line",smooth:!0,areaStyle:{normal:{}},data:[],z:1}]},p={grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},legend:{data:["本周期数据趋势","与上周期的趋势对比"]},tooltip:{trigger:"axis"},xAxis:[{type:"category",boundaryGap:!1,data:[]}],yAxis:[{type:"value"}],series:[{name:"本周期数据趋势",type:"line",smooth:!0,areaStyle:{normal:{}},data:[],markPoint:{symbolSize:60,data:[{type:"max",name:"最大值"},{type:"min",name:"最小值"}]},z:2},{name:"与上周期的趋势对比",type:"line",smooth:!0,areaStyle:{normal:{}},data:[],z:1}]},g={grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},legend:{data:["本周期数据趋势","与上周期的趋势对比"]},tooltip:{trigger:"axis"},xAxis:[{type:"category",boundaryGap:!1,data:[]}],yAxis:[{type:"value"}],series:[{name:"本周期数据趋势",type:"line",smooth:!0,areaStyle:{normal:{}},data:[],z:2},{name:"与上周期的趋势对比",type:"line",smooth:!0,areaStyle:{normal:{}},data:[],z:1}]},Y={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"value",boundaryGap:[0,.01]},yAxis:{type:"category",data:[]},series:[{name:"访问用户省市分布前10名",type:"bar",data:[]}]};i(),$(".time_btn_box").on("click",function(){$(".time_box ul").show()}),$(".time_box ul").on("click",function(t){if(!$(t.target).hasClass(".active")){$(".time_box ul li").removeClass("active"),$(t.target).addClass("active"),$(".time_box ul").hide(),$(".time_item").html($(t.target).attr("tag")+"天");var e=null,a=null,n=null,m=null;switch($(t.target).attr("tag")){case"7":e=moment(l).subtract(7,"days").startOf("day").format("l"),a=moment(l).subtract(1,"days").endOf("day").format("l"),n=moment(l).subtract(14,"days").startOf("day").format("l"),m=moment(l).subtract(8,"days").endOf("day").format("l"),$(".time").html(moment(l).subtract(7,"days").startOf("day").format("YYYY-MM-DD")+"-"+moment(l).subtract(1,"days").endOf("day").format("YYYY-MM-DD"));break;case"14":e=moment(l).subtract(14,"days").startOf("day").format("l"),a=moment(l).subtract(1,"days").endOf("day").format("l"),n=moment(l).subtract(28,"days").startOf("day").format("l"),m=moment(l).subtract(15,"days").endOf("day").format("l"),$(".time").html(moment(l).subtract(14,"days").startOf("day").format("YYYY-MM-DD")+"-"+moment(l).subtract(1,"days").endOf("day").format("YYYY-MM-DD"));break;case"28":e=moment(l).subtract(28,"days").startOf("day").format("l"),a=moment(l).subtract(1,"days").endOf("day").format("l"),n=moment(l).subtract(56,"days").startOf("day").format("l"),m=moment(l).subtract(29,"days").endOf("day").format("l"),$(".time").html(moment(l).subtract(28,"days").startOf("day").format("YYYY-MM-DD")+"-"+moment(l).subtract(1,"days").endOf("day").format("YYYY-MM-DD"));break;case"all":$(".time_item").html("全部"),e=project_b_time+" 00:00:00",a=moment(l).endOf("day").format("l"),n="",m="",$(".muted").html(project_b_time+"-"+c)}f={activity_id:d,beginTime:e,endTime:a,perBeginTime:n,perEndTime:m},u={activity_id:d,beginTime:e,endTime:a,topn:10},i()}});var b=flatpickr(".flatpickr-input",{mode:"range",locale:"zh",dateFormat:"Y-m-d H:i",onClose:function(t,e,a){console.log(t);var n=b.formatDate(b.selectedDates[0],"Y-m-d H:i:ss"),m=moment(b.selectedDates[1].getTime()).endOf("day").format("l"),s=b.formatDate(b.selectedDates[0],"Y-m-d"),r=b.formatDate(b.selectedDates[0],"Y-m-d");$(".flatpickr-input").val(b.formatDate(b.selectedDates[0],"Y-m-d H:i")+" 至 "+moment(b.selectedDates[1].getTime()).endOf("day").format("YYYY-MM-DD HH:mm"));var l=o(s,r);l>0?$(".time").html(s+" - "+r):$(".time").html(s);var c=moment(n).subtract(l+1,"days").format("YYYY-MM-DD HH:mm:ss"),y=moment(m).subtract(l+1,"days").format("YYYY-MM-DD HH:mm:ss"),c=moment(n).subtract(l+1,"days").format("YYYY-MM-DD HH:mm:ss"),y=moment(m).subtract(l+1,"days").format("YYYY-MM-DD HH:mm:ss");f={activity_id:d,beginTime:n,endTime:m,perBeginTime:c,perEndTime:y},u={activity_id:d,beginTime:n,endTime:m,topn:10},i()}})});