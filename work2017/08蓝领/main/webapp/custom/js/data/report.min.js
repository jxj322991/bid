$(function(){function t(t){1===t.code?e(t.context.currenttime):alert("初始化失败【SystemTime Get Error!】")}function e(t){r(t)}function r(t){var e=moment(new Date(t).getTime()).format("YYYY-MM-DD"),r=moment(new Date(e).getTime()).startOf("day").subtract(1,"days").format("l");moment(new Date(r).getTime()).endOf("day").format("l"),flatpickr(".flatpickr-input",{dateFormat:"Y-m-d H:i:ss",disableMobile:!0,disable:[{from:e,to:"9999"}],defaultDate:[r,r],onClose:function(t,e,r){var n=moment(t[0]).startOf("day").format("l"),o=moment(t[0]).endOf("day").format("l");$(".flatpickr-input").val(n+" ~ "+o);var d=new Date(n.replace(/-/g,"/")).getTime(),i=new Date(o.replace(/-/g,"/")).getTime();a("ReportActivity",{beginTime:d,endTime:i}),a("ReportAward",{beginTime:d,endTime:i}),a("ReportAwardTotal",{beginTime:d,endTime:i}),a("ReportCityScan",{beginTime:d,endTime:i,province:"江西"}),a("ReportProvinceScan",{beginTime:d,endTime:i}),a("ReportProvinceScanTotal",{beginTime:d,endTime:i})},onReady:function(t,e,r){var n=moment(t[0]).startOf("day").format("l"),o=moment(t[0]).endOf("day").format("l");$(".flatpickr-input").val(n+" ~ "+o);var d=new Date(n.replace(/-/g,"/")).getTime(),i=new Date(o.replace(/-/g,"/")).getTime();a("ReportActivity",{beginTime:d,endTime:i}),a("ReportActivityTrend",{beginTime:d-12096e5,endTime:i}),a("ReportAward",{beginTime:d,endTime:i}),a("ReportAwardTotal",{beginTime:d,endTime:i}),a("ReportCityScan",{beginTime:d,endTime:i,province:"江西"}),a("ReportProvinceScan",{beginTime:d,endTime:i}),a("ReportProvinceScanTotal",{beginTime:d,endTime:i})}})}function a(t,e){$.ajax({type:"POST",url:n[t].url,data:e,success:function(e){ajaxResHandle(e,n[t].method)}})}$.ajax({type:"POST",url:"/api/v1/data/GetSysTime",success:function(e){ajaxResHandle(e,t)}});var n={ReportActivity:{url:"/api/v1/data/GetReportActivity",method:function(t){for(var e=t.context.result,r="",a=0;a<e.length;a++){var n=e[a];r+="<tr>",r+="<td>"+n.name+"</td>",r+="<td>"+n.cnt+"</td>",r+="<td>"+n.hb+"%</td>",r+="<td>"+n.tb+"%</td>",r+="</tr>"}$("#reportActivity").html(r)}},ReportActivityTrend:{url:"/api/v1/data/GetReportActivityTrend",method:function(t){var e={xAxis:{type:"category",boundaryGap:!1,data:t.context.x},tooltip:{trigger:"axis"},legend:{show:!0,itemWidth:5,padding:3,data:["扫码次数","扫码包数","抽奖次数","首验包数","新用户","扫码用户"]},yAxis:{type:"value"},grid:{left:"2%",right:"6%",top:"15%",bottom:"2%",witdh:"92%",height:"80%",containLabel:!0},series:[{name:"扫码次数",type:"line",data:t.context.yScan},{name:"扫码包数",type:"line",data:t.context.yCode},{name:"抽奖次数",type:"line",data:t.context.yDraw},{name:"首验包数",type:"line",data:t.context.yVerify},{name:"扫码用户",type:"line",data:t.context.yScanuser},{name:"新用户",type:"line",data:t.context.yUser}]};echarts.init(document.getElementById("activitytrend")).setOption(e)}},ReportAward:{url:"/api/v1/data/GetReportAward",method:function(t){for(var e=t.context.result,r="",a=0;a<e.length;a++){var n=e[a];r+="<tr>","红包合计"===n.productName||"全部礼品合计"===n.productName?(r+='<tr style="color: #333;font-weight: bold;">',r+='<td style="font-weight: bold;">'+n.productName+"</td>",r+='<td style="color: #ff4545;">'+n.cnt+"</td>",r+='<td style="color: #ff4545;">'+n.money+"</td>",r+="</tr>"):(r+="<tr>",r+='<td style="font-weight: 200;">'+n.productName+"</td>",r+="<td>"+n.cnt+"</td>",r+="<td>"+n.money+"</td>",r+="</tr>")}$("#reportAward").html(r)}},ReportAwardTotal:{url:"/api/v1/data/GetReportAwardTotal",method:function(t){for(var e=t.context.result,r="",a=0;a<e.length;a++){var n=e[a];"红包合计"===n.productName||"全部礼品合计"===n.productName?(r+='<tr style="color: #333;font-weight: bold;">',r+='<td style="font-weight: bold;">'+n.productName+"</td>",r+='<td style="color: #ff4545;">'+n.cnt+"</td>",r+='<td style="color: #ff4545;">'+n.money+"</td>",r+="</tr>"):(r+="<tr>",r+='<td style="font-weight: 200;">'+n.productName+"</td>",r+="<td>"+n.cnt+"</td>",r+="<td>"+n.money+"</td>",r+="</tr>")}$("#reportAwardTotal").html(r)}},ReportCityScan:{url:"/api/v1/data/GetReportCityScan",method:function(t){for(var e=t.context.result,r="",a=0;a<e.length;a++){var n=e[a];r+="<tr>",r+='<td style="font-size: .26rem;">'+n.region+"</td>",r+="<td>"+n.scan+"</td>",r+="<td>"+n.code+"</td>",r+="<td>"+n.scanUser+"</td>",r+="<td>"+n.verify+"</td>",r+="<td>"+n.draw+"</td>",r+="</tr>"}$("#reportCityScan").html(r)}},ReportProvinceScan:{url:"/api/v1/data/GetReportProvinceScan",method:function(t){for(var e=t.context.result,r="",a=0;a<e.length;a++){var n=e[a];r+="<tr>",r+='<td style="font-size: .26rem;">'+n.region+"</td>",r+="<td>"+n.scan+"</td>",r+="<td>"+n.code+"</td>",r+="<td>"+n.scanUser+"</td>",r+="<td>"+n.verify+"</td>",r+="<td>"+n.draw+"</td>",r+="</tr>"}$("#reportProvinceScan").html(r)}},ReportProvinceScanTotal:{url:"/api/v1/data/GetReportProvinceScanTotal",method:function(t){for(var e=t.context.result,r="",a=0;a<e.length;a++){var n=e[a];r+="<tr>",r+='<td style="font-size: .26rem;">'+n.region+"</td>",r+="<td>"+n.scan+"</td>",r+="<td>"+n.code+"</td>",r+="<td>"+n.scanUser+"</td>",r+="<td>"+n.verify+"</td>",r+="<td>"+n.draw+"</td>",r+="</tr>"}$("#reportProvinceScanTotal").html(r)}}}});