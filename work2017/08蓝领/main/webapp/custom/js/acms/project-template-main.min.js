function getActivity(){$.get("/api/v1/acms/GetActivity",{activity_id:activityId,cache:!1,with_params:!0,with_rules:!1,with_rates:!0,with_banners:!0}).done(function(a){ajaxResHandle(a,function(){var t=a.context,e=t.activity||{},i={};(banners=t.banners||[]).length>0&&$.each(banners,function(a,t){1===t.status&&(i=t)});var n=t.params||{};t.rates&&(ratesObj=t.rates),$(".banner").html('<h1 class="banner-info">'+e.name+'</h1>\n            <img src="'+(i.image&&i.image)+'" class="banner-img">\n            <ul class="banner-mask clearfix">\n            <li class="banner-mask_item">\n            '+e.beginTime+"-"+e.endTime+'\n            </li>\n            <li class="banner-mask_item spread">\n                #'+e.type+"\n        </li>\n        </ul>"),$(".data_title h3").html(e.name),$("#attr").html(tmpl("template_params",a.context)),i.image&&($("#banner").val(i.image).data("bannerid",i.id),$('[data-img="banner"]').html(i.image)),wechat(),actBeginCalendar=flatpickr("#actBeginTime",{mode:"single",enableTime:!0,time_24hr:!0,defaultHour:24,defaultMinute:0,locale:"zh",dateFormat:"Y-m-d H:i",defaultDate:e.beginTime?e.beginTime:"",disableMobile:!1,plugins:[new confirmDatePlugin({confirmText:"确认 ",showAlways:!0,theme:"light"})],onChange:function(a,t,e){console.log(a,t,e),actEndCalendar.set("minDate",a[0])}}),actEndCalendar=flatpickr("#actEndTime",{mode:"single",enableTime:!0,time_24hr:!0,defaultHour:24,defaultMinute:0,locale:"zh",dateFormat:"Y-m-d H:i",defaultDate:e.endTime?e.endTime:"",disableMobile:!1,plugins:[new confirmDatePlugin({confirmText:"确认 ",showAlways:!0,theme:"light"})],onChange:function(a,t,e){actBeginCalendar.set("maxDate",a[0])}}),$('[name="acms.act.alert.quantity"]').val(n["acms.act.alert.quantity"]?n["acms.act.alert.quantity"].value:0),$('[name="acms.act.alert.cost.day"]').val(n["acms.act.alert.cost.day"]?n["acms.act.alert.cost.day"].value:0),$('[name="acms.act.alert.cost.total"]').val(n["acms.act.alert.cost.total"]?n["acms.act.alert.cost.total"].value:0),firstBeginTimeCalendar=flatpickr("#firstBeginTime",{mode:"single",enableTime:!0,time_24hr:!0,defaultHour:24,defaultMinute:0,locale:"zh",dateFormat:"Y-m-d H:i",defaultDate:n["acms.act.award.first.begin"]&&n["acms.act.award.first.begin"].value?n["acms.act.award.first.begin"].value-0:"",disableMobile:!1,plugins:[new confirmDatePlugin({confirmText:"确认 ",showAlways:!0,theme:"light"})],onChange:function(a,t,e){console.log(selectedDate),firstEndTimeCalendar.set("minDate",a[0])}}),firstEndTimeCalendar=flatpickr("#firstEndTime",{mode:"single",enableTime:!0,time_24hr:!0,defaultHour:24,defaultMinute:0,locale:"zh",dateFormat:"Y-m-d H:i",defaultDate:n["acms.act.award.first.end"]&&n["acms.act.award.first.end"].value?n["acms.act.award.first.end"].value-0:"",disableMobile:!1,plugins:[new confirmDatePlugin({confirmText:"确认 ",showAlways:!0,theme:"light"})],onChange:function(a,t,e){console.log(selectedDate),firstBeginTimeCalendar.set("maxDate",a[0])}}),ratesObj.default&&($(".prizes-block_container").html(""),$("#firstSku").html(""),$(ratesObj.default.rates).each(function(){$("#firstSku").append('<option value="'+this.pid+'" data-skuid="'+this.pid+'"></option>'),$(".prizes-block_container").append('<li class="prizes-block_item">\n                                        <div class="prizes-block" data-skuid="'+this.pid+'" data-cj="bcAward"></div>\n                                    </li>')}),n["acms.act.broadcast.pid"]&&$('[data-cj="bcAward"][data-skuid="'+n["acms.act.broadcast.pid"].value+'"]').addClass("active"),$('[data-cj="bcAward"]').click(function(){if(!$(this).hasClass("active")){$(this).closest(".prizes-block_container").find(".prizes-block.active").removeClass("active"),$(this).addClass("active");var a=$.Event("change.cj.bcAward");$(this).trigger(a)}}),n["acms.act.award.first.sku"]&&$("#firstSku").val(n["acms.act.award.first.sku"].value)),$("#modal-rate").on("shown.cj.modal",function(a){$("#modal-rate .box_num_b").html("");var t=a.relatedTarget;if(t){var e=$(t).data("group");ratesObj[e]?$(ratesObj[e].rates).each(function(){$("#modal-rate .box_num_b").append('<div class="m_num">\n                 <p>'+this.name+'</p>\n                 <input type="tel" value="'+this.rate+'" name="'+this.pid+'">\n                 </div>')}):ratesObj.default?$(ratesObj.default.rates).each(function(){$("#modal-rate .box_num_b").append('<div class="m_num">\n                <p>'+this.name+'</p>\n                <input type="tel" value="'+this.rate+'" name="'+this.pid+'">\n            </div>')}):$("#modal-rate .box_num_b").html("请先添加奖品"),$(this).find("[data-cj=save]").off().click(function(){var a=$("#modal-rate").serializeArray(),i=[],n=0;if($.each(a,function(a,t){var e={skuId:t.name,rate:t.value,needHelp:!1};n+=t.value-0,i.push(e)}),n>100)alert("总概率不能超过100");else{var d={activityId:activityId,group:e,awards:i},s=$.Event("change.cj.rate");$(t).trigger(s).data("awards",JSON.stringify(d)),$("[data-dismiss=modal]").trigger("click")}})}else console.warn("设置概率缺少触发元素！")}).on("hidden.cj.modal",function(){}),getAwardList()})})}function copywriting(){""!==$.trim($(this).text())&&footerBtnStatus()}function footerBtnStatus(){$(".set_menu.active").data("change","true"),$(".footer-btn_container").show(),$(".body").addClass("body-m-b200"),$("[data-cj=updateParams]").off().click(function(){$(".set_menu.active").find("[type=submit]").trigger("click")}),$("[data-cj=resetParams]").off().click(function(){confirm("确定重置？")?resetParams():$(".footer-btn_container").hide()})}function getAwardList(){$.get("/func/acms/award/list",{activity_id:activityId}).done(function(a){ajaxResHandle(a,function(){var t=a.data.exists||[];$("#existsList").html(""),$(".gift_box").html("");var e={};if(t.length>0){if($.each(t,function(a,t){$("#existsList").append('<div class="gift_s" data-cj="modal" data-target="#modal-strategy" data-skuid="'+t.skuId+'">\n                            <img src="'+t.image+'" alt="奖品图">\n                            <h5>'+t.skuName+"</h5>\n                            <p>剩余库存:<span>"+t.quantity+"</span>个</p>\n                            <p>需要拆礼盒: <span>"+(t.needHelp?"是":"否")+"</span></p>\n                            <p>默认概率:<span>"+t.defaultRate+"%</span></p>\n                        </div>"),$(".gift_box").append('<div class="m_box" data-cj="awardConfig" data-max="'+t.allQuantity+'" data-rate="'+t.defaultRate+'" data-help="'+(t.needHelp?1:0)+'" data-skuid="'+t.skuId+'" data-addquantity="0">\n                                <img src="'+t.image+'" alt="奖品图">\n                                <p>'+t.skuName+"</p>\n                            </div>"),$(".prizes-block_container").find('[data-skuid="'+t.skuId+'"]').text(t.skuName?t.skuName:"null"),$("#firstSku").find('[data-skuid="'+t.skuId+'"]').text(t.skuName?t.skuName:"null"),e[t.skuId]=t.skuName}),!$.isEmptyObject(ratesObj))for(var i in ratesObj)if(ratesObj[i].rates.length>0)for(var n=ratesObj[i].rates,d=0,s=n.length;d<s;d++)n[d].name=e[n[d].pid];console.log(ratesObj)}$(".gift_box").prepend('<div class="m_box" data-cj="modal" data-target="#org-quantity">\n                                <h3 class="j_add_gift"></h3>\n                            </div>'),$(".gift_box").on("click","[data-cj=awardConfig]",function(){if(!$(this).hasClass("j_active")){$("#quantity-config").find("[name=quantity]").prop("disabled",!1),$("#quantity-config").find("[name=defaultRate]").prop("disabled",!1);var a={number:/^-?(\d*\.)?\d+(e[-+]?\d+)?$/i,integer:/^-?\d+$/},t=$.trim($("#quantity-config").find("[name=quantity]").val()),e=$(".gift_box .m_box.j_active");if(t.length<=0)return void $("[data-info=validate]").html("库存不能为空");if(!a.integer.test(t))return void $("[data-info=validate]").html("库存必须为整数");if(t<0)return void $("[data-info=validate]").html("库存最小为0");var i=e.data("max");if(i&&t>i)return void $("[data-info=validate]").html("库存最大为"+i);if((t=$.trim($("#quantity-config").find("[name=defaultRate]").val())).length<=0)return void $("[data-info=validate]").html("概率不能为空");if(!a.number.test(t))return void $("[data-info=validate]").html("概率必须为数字");if(t<0)return void $("[data-info=validate]").html("概率最小为0");if(t>100)return void $("[data-info=validate]").html("概率最大为100");e.data("help",$("#quantity-config").find("[name=needHelp]").val()),e.data("addquantity",$("#quantity-config").find("[name=quantity]").val()),e.data("rate",$("#quantity-config").find("[name=defaultRate]").val()),$("[data-info=validate]").html(""),e.removeClass("j_active"),$(this).addClass("j_active"),$("#quantity-config").find("[name=quantity]").val($(this).data("addquantity")),$("#quantity-config").find("[data-info=allQuantity]").html($(this).data("max")),$("#quantity-config").find("[name=needHelp]").val($(this).data("help")).trigger("change"),$("#quantity-config").find("[name=defaultRate]").val($(this).data("rate"))}}),$("#modal-strategy").on("shown.cj.modal",function(a){var t=a.relatedTarget,e=$(t).data("skuid");e&&$(".gift_box").find("[data-skuid="+e+"]").trigger("click")}).on("hidden.cj.modal",function(){$("#quantity-config").find("[name=quantity]").prop("disabled",!0),$("#quantity-config").find("[name=defaultRate]").prop("disabled",!0),$(".gift_box").find("[data-cj=awardConfig]").removeClass("j_active"),$("#quantity-config").find("[name=quantity]").val(0),$("#quantity-config").find("[name=needHelp]").val(0).trigger("change"),$("#quantity-config").find("[name=defaultRate]").val(0)}),$("#existsList").prepend('<div class="gift_s">\n                            <a href="#modal-strategy" data-cj="modal"><h3 class="j_add_gift"></h3></a>\n                        </div>'),$("[data-cj=updateEexists]").click(function(){var a={number:/^-?(\d*\.)?\d+(e[-+]?\d+)?$/i,integer:/^-?\d+$/},t=$.trim($("#quantity-config").find("[name=quantity]").val()),e=$(".gift_box .m_box.j_active");if(t.length<=0)$("[data-info=validate]").html("库存不能为空");else if(a.integer.test(t))if(t<0)$("[data-info=validate]").html("库存最小为0");else{var i=e.data("max");if(i&&t>i)$("[data-info=validate]").html("库存最大为"+i);else if((t=$.trim($("#quantity-config").find("[name=defaultRate]").val())).length<=0)$("[data-info=validate]").html("概率不能为空");else if(a.number.test(t))if(t<0)$("[data-info=validate]").html("概率最小为0");else if(t>100)$("[data-info=validate]").html("概率最大为100");else{e.data("help",$("#quantity-config").find("[name=needHelp]").val()),e.data("quantity",$("#quantity-config").find("[name=quantity]").val()),e.data("rate",$("#quantity-config").find("[name=defaultRate]").val());var n=$("[data-cj=awardConfig]"),d=[];if(n.length<0)$("[data-info=validate]").html("还没有添加奖品");else{var s=0;if(n.each(function(){s+=$(this).data("rate")-0;var a={skuId:$(this).data("skuid"),addQuantity:$(this).data("quantity"),needHelp:!!($(this).data("help")-0),rate:$(this).data("rate")};d.push(a)}),s>100)$("[data-info=validate]").html("所有奖品的概率总和不能大于100");else{$("[data-info=validate]").html("");var c={activityId:activityId,group:"default",awards:d};$.post("/func/acms/rate/update",{award_config:JSON.stringify(c)}).done(function(a){ajaxResHandle(a,function(){resetParams(),$("[data-dismiss=modal]").trigger("click")})})}}}else $("[data-info=validate]").html("概率必须为数字")}else $("[data-info=validate]").html("库存必须为整数")});var c=a.data.not_added||[];$(".org-list").html(""),$.each(c,function(a,t){$(".org-list").append('<div>\n                        <div class="checkbox-inline">\n                            <label class="checkbox">\n                                <input type="checkbox" hidden name="'+t.skuId+'" value="0"> '+t.skuName+"\n                            </label>\n                        </div>\n                    </div>")})})})}function wechat(){$.get("/api/v1/acms/GetWechatHostings").done(function(a){ajaxResHandle(a,function(){a.context.length>0&&$.each(a.context,function(a,t){$("#copywriting_wechat").append('<option data-id="'+t.authorizerAppid+'">'+t.nickname+"</option>")})})})}var activityId=$.getSingleParam("activityid"),typeTesters={email:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,number:/^-?(\d*\.)?\d+(e[-+]?\d+)?$/i,integer:/^-?\d+$/,digits:/^\d+$/,alphanum:/^\w+$/i,url:new RegExp("^(?:(?:https?|ftp):)?//(?:\\S+(?::\\S*)?@)?(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))(?::\\d{2,5})?(?:/\\S*)?$","i")};$.post("/api/v1/data/GetTraceid",{activity_id:activityId}).done(function(a){ajaxResHandle(a)}),$.post("/api/v1/data/GetActivity",{activity_id:activityId}).done(function(a){ajaxResHandle(a,function(){a=a.context,$('[data-info="yUV"]').html(a.yUV),$('[data-info="yPV"]').html(a.yPV),$('[data-info="yScan"]').html(a.yScan),$('[data-info="yDraw"]').html(a.yDraw),$('[data-info="yOrder"]').html(a.yOrder),$('[data-info="yOrderMoney"]').html(a.yOrderMoney)})}),$(".g_notice_set .menu_c div").on("click",function(a){var t=a.target,e=$(t);e.hasClass("j_active")||(e.addClass("j_active"),e.siblings().removeClass("j_active"),e.hasClass("yes_c")?$(".set_menu .menu_b").show():$(".set_menu .menu_b").hide())}),$(".g_notice_set .menu_s").on("click","button",function(a){var t=a.target;$(t);$(".g_notice_pop").removeClass("hide")}),$(".g_notice_pop .box_a").on("click",".img_up",function(a){$("#j_img_up").trigger("click")}),$(".link input").on("focus",function(){$(".link_e").hide()}),$(".g_notice_pop .menu_c div").on("click",function(a){var t=a.target,e=$(t);e.hasClass("j_active")||(e.addClass("j_active"),e.siblings().removeClass("j_active"))}),$(".j_yes").click(function(){$(".g_notice_pop").addClass("hide")}),$(".j_no").click(function(){$(".g_notice_pop").addClass("hide")}),$("[data-cj=goData]").click(function(){location.href="/html/data/data-nav.html?activityid="+activityId}),$("[data-cj=tab]").click(function(a){if($(a).is("a")&&a.preventDefault(),!$(this).hasClass("j_active")){"true"===$(".set_menu.active").data("change")&&(confirm('属性未保存，点击"确定"保存，"取消"放弃保存')?$("[data-cj=updateParams]").trigger("click"):$("[data-cj=resetParams]").trigger("click")),$(this).closest(".nav").find("[data-cj=tab]").removeClass("j_active"),$(this).addClass("j_active");var t=$(this).attr("href")||$(this).data("target");$(t).closest(".tab-content").find(".set_menu").removeClass("active in"),a=$.Event("shown.cj.tab",{relatedTarget:this}),$(t).addClass("active in").trigger(a),$("html,body").scrollTop(0)}}),$(document).on("change","input:radio",function(){var a=$(this).attr("name");$('[name="'+a+'"]').closest(".radio").removeClass("checked"),$(this).closest(".radio").addClass("checked")}),$(document).on("change","input:checkbox",function(){var a=$(this).closest(".checkbox");$(this).is(":checked")?a.addClass("checked"):a.removeClass("checked")}),$(document).on("click","[data-cj=modal]",function(a){$(this).is("a")&&a.preventDefault();var t=$(this).attr("href")||$(this).data("target");a=$.Event("shown.cj.modal",{relatedTarget:this}),$(t).removeClass("hide").trigger(a),$("[data-dismiss=modal]").off().click(function(a){$(this).is("a")&&a.preventDefault();var t=$(this).attr("href")||$(this).data("target");a=$.Event("hidden.cj.modal"),$(t).addClass("hide").trigger(a)})}),$(".bg-img_container").on("click",".bg-img_item",function(){$(this).hasClass("active")||"file"===$(this).data("type")||($(".bg-img_container .bg-img_item.active").removeClass("active"),$(this).addClass("active"),$(this).closest("form").find('[name="thumb"]').val($(this).data("url")).data("id",$(this).data("id")).data("action","change"))});var upLoadTar=void 0,banners=[];$("#modal-upLoadImg").on("success.io.upload",function(){$(".bg-img_container .bg-img_item.active").removeClass("active"),$(this).find('[name="thumb"]').data("action","add").data("id","")}).on("shown.cj.modal",function(a){var t=a.relatedTarget,e=$(this);if(t)if(upLoadTar=a.relatedTarget,"act-background"===$(t).data("img")||"qrcode"===$(t).data("img")){var i=$.trim($(t).text());i.length>0&&($(this).find("[data-info=url]").val(i),$(this).find(".pic img").attr("src",i))}else if("banner"===$(t).data("img")&&banners.length>0)for(var n=banners.length-1;n>=0;n--)$(this).find(".bg-img_container").append('<li class="bg-img_item" data-id="'+banners[n].id+'" data-url="'+banners[n].image+'">\n                        <div class="bg-img">\n                        <img src="'+banners[n].image+'">\n                        </div>\n                        </li>');$('[data-cj="imgSave"]').off().click(function(){var a=$.trim(e.find("[data-info=url]").val());if(a.length<=0)e.find("h6").html("不能为空");else if(typeTesters.url.test(a)){if(upLoadTar){var t=$("#modal-upLoadImg [data-info=url]").val(),i=$("#modal-upLoadImg [data-info=url]").data("id"),n=$("#modal-upLoadImg [data-info=url]").data("action");$(upLoadTar).html(t).next("[type=hidden]").val(t).data("bannerid",i).data("action",n);var d=$.Event("img.change");$(upLoadTar).trigger(d)}$("[data-dismiss=modal]").trigger("click")}else e.find("h6").html("请输入正确的图片地址")})}).on("hidden.cj.modal",function(){var a=$(this);a.find('[type = "text"]').val(""),a.find(".bg-img_container").html('<li class="bg-img_item" data-type="file">\n                        <div class="pic bg-img">\n                            <img src="//saascore.oss-cn-beijing.aliyuncs.com/custom/img/common/upload.jpg" alt="分享图">\n                            <input type="file" class="file" accept="image/png,image/jpg,image/jpeg" name="file" value="上传图片" data-cj="imgUpload">\n                        </div>\n                    </li>'),a.find("h6").html("")}),isWeixin?($('[data-cj="imgUpload"]').hide(),$("[data-cj=wxUpLoad]").click(function(){var a=$(this);wx.ready(function(){wx.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(t){var e=t.localIds;wx.uploadImage({localId:e[0],isShowProgressTips:1,success:function(t){var e=t.serverId;$.post("/io/upload/fwx",{mediaId:e}).done(function(t){ajaxResHandle(t,function(){var e=t.data;if(e){a.closest("form").find('[name="thumb"]').val(e),a.siblings("img").remove(),$('<img src="'+e+'">').insertBefore(a);var i=$.Event("success.io.upload");$("#modal-upLoadImg").trigger(i)}})})}})}})})})):($("[data-cj=wxUpLoad]").hide(),$('[data-cj="imgUpload"]').change(function(){var a=$(this),t=new FormData;t.append("file",this.files[0]);var e=a.data("channel");t.append("channel",e),$.ajax({url:"/io/upload",type:"POST",cache:!1,data:t,processData:!1,contentType:!1,dataType:"json"}).done(function(t){ajaxResHandle(t,function(){var e=t.data;if(e){a.closest("form").find('[name="thumb"]').val(e),a.siblings("img").remove(),$('<img src="'+e+'">').insertBefore(a);var i=$.Event("success.io.upload");$("#modal-upLoadImg").trigger(i)}})})})),$("#modal-upLoadImg [data-info = url]").on("change",function(){$(this).data("action","add"),$("#modal-upLoadImg .pic img").attr("src",$(this).val())});var actBeginCalendar=void 0,actEndCalendar=void 0,firstBeginTimeCalendar=void 0,firstEndTimeCalendar=void 0,ratesObj={};getActivity();var resetParams=function(){getActivity(),$(".set_menu.active").data("change","false"),$("#attr").parsley().reset(),$("#strategy").parsley().reset(),$('[data-group="first"]').data("awards",""),$(".footer-btn_container").hide(),$(".body").removeClass("body-m-b200")};$(".tab-content").on("change","input,select,textarea",footerBtnStatus).on("img.change","[data-cj=modal]",footerBtnStatus).on("change.cj.rate","[data-cj=modal]",footerBtnStatus).on("change.cj.bcAward","[data-cj=bcAward]",footerBtnStatus).on("blur",".copywriting",copywriting),$("#attr").parsley().on("form:submit",function(){var a=this.$element.serializeObject();a.activity_id=activityId,a["acms.act.broadcast.pid"]=this.$element.find(".prizes-block_container .prizes-block.active").data("skuid")||"",a["acms.act.rules"]=$("#copywriting_rules").text(),a["acms.act.cstext"]=$("#copywriting_kefu").text(),a["acms.act.copyright"]=$("#copywriting_footer").text(),a["acms.act.org"]=$("#copywriting_sponsor").text(),a["acms.act.wechat"]=$("#copywriting_wechat option:checked").data("id"),console.log(a);var t=0,e={};1===actBeginCalendar.selectedDates.length&&1===actEndCalendar.selectedDates.length?(e.activity_id=a.activity_id,e.begin_time=new Date(actBeginCalendar.selectedDates[0]).getTime(),e.end_time=new Date(actEndCalendar.selectedDates[0]).getTime(),$.post("/api/v1/acms/SetActivityTimeRange",e).done(function(a){ajaxResHandle(a,function(){100===(t+=25)&&resetParams()})})):t+=25;var i=$("#banner").data("action");return"add"===i?$.post("/api/v1/acms/AddBanner",{activity_id:activityId,image:$("#banner").val()}).done(function(a){ajaxResHandle(a,function(){100===(t+=25)&&resetParams()})}):"change"===i?$.post("/api/v1/acms/UpdateBanner",{activity_id:activityId,banner_id:$("#banner").data("bannerid"),status:1}).done(function(a){ajaxResHandle(a,function(){100===(t+=25)&&resetParams()})}):100===(t+=25)&&resetParams(),$.post("/api/v1/acms/BatchUpdateParamValue",a).done(function(a){ajaxResHandle(a,function(){100===(t+=50)&&resetParams()})}),!1}),$("#quantity-config").on("click",'[data-cj="changeStatus"]',function(){var a=$(this);a.hasClass("j_active")||(a.addClass("j_active"),a.siblings().removeClass("j_active"),a.hasClass("yes_c")?a.siblings("input[type=hidden]").val(1):a.siblings("input[type=hidden]").val(0))}).find("[name=needHelp]").change(function(){$(this).val()-0?$(this).siblings(".yes_c").trigger("click"):$(this).siblings(".no_c").trigger("click")}),$("#org-quantity").on("shown.cj.modal",function(){$("#orgEdit").hide(),$("[data-cj=notAdd2Eexists]").off().click(function(){var a=$(".org-list").serializeArray(),t=[];$.each(a,function(a,e){var i={skuId:e.name,addQuantity:0,needHelp:!1,rate:0};t.push(i)});var e={activityId:activityId,group:"default",awards:t};$.post("/func/acms/rate/update",{award_config:JSON.stringify(e)}).done(function(a){ajaxResHandle(a,function(){resetParams(),$("#org-quantity [data-dismiss=modal]").trigger("click")})})})}).on("hidden.cj.modal",function(){$("#orgEdit").show()}),$("#strategy").parsley().on("form:submit",function(){var a=0,t=this.$element.serializeObject();t.activity_id=activityId,firstBeginTimeCalendar.selectedDates.length>0&&(t["acms.act.award.first.begin"]=new Date(firstBeginTimeCalendar.selectedDates[0]).getTime()),firstEndTimeCalendar.selectedDates.length>0&&(t["acms.act.award.first.end"]=new Date(firstEndTimeCalendar.selectedDates[0]).getTime()),$.post("/api/v1/acms/BatchUpdateParamValue",t).done(function(t){ajaxResHandle(t,function(){100===(a+=50)&&resetParams()})});var e=$('[data-cj=modal][href="#modal-rate"]');if(e&&e.data("awards")){e.data("group"),e.data("awards");$.post("/func/acms/rate/update",{award_config:e.data("awards")}).done(function(t){ajaxResHandle(t,function(){100===(a+=50)&&resetParams()})})}else 100===(a+=50)&&resetParams();return!1});