var g_1499051634={};g_1499051634.author="jxj",function(){function t(t){console.log(t),$("#modal-notice").addClass("hide"),$("#j_img_up").val(null),$("#j_img_up").addClass("j_img_up"),setTimeout(function(){o()},500)}function a(t){var a=t.replace(/:/g,"-"),e=(a=a.replace(/ /g,"-")).split("-"),n=new Date(Date.UTC(e[0],e[1]-1,e[2],e[3]-8,e[4],e[5]));return parseInt(n.getTime())}function e(t){s.img_data=t.data.replace(/(https:)|(http:)/,""),$("#j_img_up").removeClass("j_img_up"),console.log(s)}function n(t,a){var e="",n=(t.context||[]).length,i=d.data.pageNo+n;if(d.data.pageNo=i,n>0)for(var o=0;o<t.context.length;o++)e+='\n          <div class="menu_a" data-beginTime=\''+t.context[o].beginTime.split(" ")[0]+"' data-endTime='"+t.context[o].endTime.split(" ")[0]+"' data-title='"+t.context[o].title+"' data-target='"+t.context[o].target+"' data-image='"+t.context[o].image+"' data-isTop='"+t.context[o].isTop+"' data-activityId='"+t.context[o].activityId+"' data-announceId='"+t.context[o].announceId+"' data-status='"+t.context[o].status+"'>\n                    <img src=\""+t.context[o].image+'" alt="sx">\n                    <div class="menu_s">\n                        <h3>'+t.context[o].title+"</h3>\n                        <p>"+t.context[o].beginTime.split(" ")[0]+"-"+t.context[o].endTime.split(" ")[0]+'</p>\n                        <button type="button" data-cj="modal" data-target="#modal-notice">编辑</button>\n                    </div>\n                </div>\n            ';else a.lock(),a.noData(),console.log("锁定");$("#notice .menu_b").append(e),a.resetload(),0==d.data.pageNo&&($(".dropload-down").hide(),$("#notice").html('<img src="//saascore.oss-cn-beijing.aliyuncs.com/mobile/custom/img/acms/nodata.png" alt="" class="nodata-img">\n<div class="nodata-info">暂无数据</div>'))}function i(t){var a=new RegExp("(^|&)"+t+"=([^&]*)(?:&|$)","i"),e=window.location.search.substr(1).match(a);return null!=e?e[2]:null}function o(){$.ajax({url:"/api/v1/acms/GetAnnouncement",method:"GET",data:{activity_id:"act-Va2MiqDvZNu0F0pJ",pageNo:1,pageSize:1e3,status:1}}).done(function(t){ajaxResHandle(t,n)})}function l(t){$.ajax({url:"/io/upload",type:"POST",cache:!1,data:t,processData:!1,contentType:!1,dataType:"json"}).done(function(t){ajaxResHandle(t,e)})}function c(a){$.ajax({url:"/api/v1/acms/UpdateAnnouncement",type:"POST",data:a}).done(function(a){ajaxResHandle(a,t)})}var s={};s.name="i_data",s.status="ok",s.effect="公告配置";var d={url:"/api/v1/acms/GetAnnouncement",method:"GET",data:{activity_id:"act-Va2MiqDvZNu0F0pJ",pageNo:0,pageSize:10,status:1}},u=!1;$('[data-target="#notice"]').on("click",function(){if(!u){u=!0,$("#notice .dropload-down").remove();var t=$("#notice ").dropload({scrollArea:window,autoLoad:!0,distance:10,loadDownFn:function(a){console.log(d),$.ajax(d).done(function(t){ajaxResHandle(t,n,[a])}).fail(function(e,n){a.lock(),a.noData(),a.resetload(),$("#notice ").html('<div class="dropload-error">加载出错<br>点我重试</div>'),$(".dropload-error").off().click(function(){t.noData(!1),t.unlock(),t.resetload()})})}});$("#notice .menu_b").html(" ")}}),$("#j_img_up").on("change",function(){var t=$(this),a=new FormData;if(this.files[0]){a.append("file",this.files[0]);var e=t.data("channel");a.append("channel",e),l(a)}else s.img_1499051634=s.image});flatpickr("#noticeBeginTime",{mode:"single",enableTime:!0,time_24hr:!0,defaultHour:24,defaultMinute:0,locale:"zh",dateFormat:"Y-m-d H:i",defaultDate:"",disableMobile:!1,plugins:[new confirmDatePlugin({confirmText:"确认 ",showAlways:!0,theme:"light"})],onChange:function(t,a,e){console.log("change")}});$(".g_notice_set .menu_c div").on("click",function(t){var a=t.target,e=$(a);e.hasClass("j_active")||(e.addClass("j_active"),e.siblings().removeClass("j_active"),e.hasClass("yes_c")?$(".set_menu .menu_b").show():$(".set_menu .menu_b").hide())}),$("#modal-notice").on("shown.cj.modal",function(t){var a=$(t.relatedTarget).closest(".menu_a");s.begintime=a.attr("data-begintime"),s.endtime=a.attr("data-endtime"),s.target=a.attr("data-target"),s.image=a.attr("data-image"),s.title=a.attr("data-title"),s.isTop=Number(a.attr("data-isTop")),s.activityId=a.attr("data-activityId"),s.announceId=a.attr("data-announceId"),s.status=Number(a.attr("data-status")),s.img_data=s.image,$(".title_set input").val(s.title),s.target&&"null"!=s.target&&($(".link input").val(s.target),$(".link .link_e").hide()),$($(".time_a .time_s")[0]).find("input").val(s.begintime),$($(".time_a .time_s")[1]).find("input").val(s.endtime),"1"==s.isTop?($(".g_notice_pop .menu_c div").removeClass("j_active"),$(".g_notice_pop .yes_c").addClass("j_active")):($(".g_notice_pop .menu_c div").removeClass("j_active"),$(".g_notice_pop .no_c").addClass("j_active"))}),$(".g_notice_pop .box_a").on("click",".img_up",function(){$("#j_img_up").trigger("focus")}),$(".link input").on("keyup",function(){$(".link input").val()?$(".link_e").hide():$(".link_e").show()}),$(".g_notice_pop .menu_c div").on("click",function(t){var a=$(t.target);a.hasClass("yes_c")?s.isTop="1":s.isTop="0",a.hasClass("j_active")||(a.addClass("j_active"),a.siblings().removeClass("j_active"))}),$("#modal-notice .save").on("click",function(){var t={};if(t.activity_id=s.activityId,t.announcement_id=s.announceId,t.image=s.img_data,t.isTop=s.isTop,t.status=s.status,$(".title_set input").val().length<=0)alert("请输入正确活动主题文字");else if($($(".time_a .time_s")[0]).find("input").val().length<=0)alert("请输入正确开始时间");else if($($(".time_a .time_s")[1]).find("input").val().length<=0)alert("请输入正确结束时间");else{$(".link input").val()?t.target=$(".link input").val():t.target=void 0,t.title=$(".title_set input").val();e=$($(".time_a .time_s")[0]).find("input").val()+" 00:00:00";t.beginTime=a(e);var e=$($(".time_a .time_s")[1]).find("input").val()+" 00:00:00";t.endTime=a(e),console.log(t),c(t)}}),$("#modal-notice .default").on("click",function(){$("#j_img_up").val(null),$("#j_img_up").addClass("j_img_up")}),g_1499051634.activityid=i("activityid")}();