var result="";if(isWeixin){var scanQRCode=function(){wx.scanQRCode({needResult:1,scanType:["qrCode","barCode"],success:function(e){if(-1!==(result=e.resultStr+"").indexOf(",")&&(result=result.split(",")[1].replace(/^\\s|\\s$/g,"")),urlReg.test(result)){var t=/https?:\/\/.+?\.(tbul.cn|cjiot.cc)\/\?c=(.+)/gi;if(t.test(result))result=result.replace(t,function(e,t,s){return s});else{var s=result.lastIndexOf("/");-1!==s&&(result=result.slice(s+1))}}"scan"!==result.substring(0,4)&&""!==result&&($(".scan-content").addClass("invisible"),statusQuery())}})},statusQuery=function(){$.get("/api/v1/qr/GetQrcode",{qrcode:result}).done(function(e){1===e.code?$("#info").html(tmpl("template_info",e.context)):11006===e.code||11005===e.code?($("#info").addClass("invisible"),$("#no-info").removeClass("invisible")):403===e.code?window.location.replace("/html/account/login.html?ru="+decodeURIComponent(location.href)):alert(e.msg)})},urlReg=/^https?:\/\/(([a-zA-Z0-9_-])+(\.)?)*(:\d+)?(\/((\.)?(\?)?=?&?[a-zA-Z0-9_-](\?)?)*)*$/i;wx.ready(function(){scanQRCode()}),$(".code-content").on("click",'[data-click="scan-again"]',function(){scanQRCode()}),$(".code-content").on("click",'[data-click="delete-code"]',function(){$.post("/api/v1/qr/DisableQrcode",{codeList:result}).done(function(e){ajaxResHandle(e,function(){alert("该码作废成功！"),statusQuery()})})})}else document.head.innerHTML='<title>抱歉，出错了</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0"><link rel="stylesheet" type="text/css" href="https://res.wx.qq.com/open/libs/weui/0.4.1/weui.css">',document.body.innerHTML='<div class="weui_msg"><div class="weui_icon_area"><i class="weui_icon_info weui_icon_msg"></i></div><div class="weui_text_area"><h4 class="weui_msg_title">请在微信客户端打开链接</h4></div></div>';